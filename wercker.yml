box: golang:1.6

build:
  steps:
  - script:
      name: "Install unzip and jq"
      code: |
        apt-get update -y
        apt-get install -y unzip jq
  - script:
      name: "Fetch bins"
      code: |
        mkdir -p ${WERCKER_OUTPUT_DIR}/bin

        # install ghr
        scripts/ghr-fetch tcnksm/ghr > ghr.zip && unzip -p ghr.zip ghr > ${WERCKER_OUTPUT_DIR}/bin/ghr

        # install dkr
        scripts/ghr-fetch fd/dkr-util | tar -C ${WERCKER_OUTPUT_DIR}/bin -xz

        # install k8s
        # ...


deploy:
  steps:
  - script:
      name: "Install bins"
      code: |
        chmod a+x ./bin/*
        cp ./bin/* /usr/local/bin/
        rm -rf /pipeline /report
  - internal/docker-push:
      username: $DKR_USERNAME
      password: $DKR_PASSWORD
      tag: latest
      repository: simonmenke/go-build
      registry: https://registry.hub.docker.com
